{"version":3,"sources":["../../../src/verification/pipeline.ts"],"sourcesContent":["/**\n * Verification Pipeline - End-to-End Task Verification System\n *\n * Orchestrates the complete verification workflow including:\n * - Task execution with multiple agents\n * - Cross-agent verification and truth scoring\n * - Conflict detection and resolution\n * - Error handling and recovery\n */\n\nimport { EventEmitter } from 'events';\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\n\ninterface PipelineConfig {\n  agents: AgentConfig[];\n  tasks: TaskConfig[];\n  verificationRules: VerificationRule[];\n  truthThreshold: number;\n  timeoutMs: number;\n}\n\ninterface AgentConfig {\n  id: string;\n  type: string;\n  capabilities: string[];\n  reliability: number;\n  verificationEnabled: boolean;\n}\n\ninterface TaskConfig {\n  id: string;\n  description: string;\n  requiredCapabilities: string[];\n  expectedDuration: number;\n  verificationCriteria: VerificationCriteria;\n}\n\ninterface VerificationRule {\n  name: string;\n  condition: string;\n  action: 'warn' | 'reject' | 'escalate';\n  threshold: number;\n}\n\ninterface VerificationCriteria {\n  requiresTests: boolean;\n  requiresCodeReview: boolean;\n  requiresBuild: boolean;\n  minTruthScore: number;\n  crossVerificationRequired: boolean;\n}\n\ninterface PipelineResult {\n  taskId: string;\n  status: 'completed' | 'failed' | 'timeout' | 'rejected';\n  truthScore: number;\n  verificationResults: VerificationStepResult[];\n  duration: number;\n  agentPerformance: Map<string, AgentPerformance>;\n  errors: string[];\n}\n\ninterface VerificationStepResult {\n  step: string;\n  agentId: string;\n  passed: boolean;\n  truthScore: number;\n  evidence: any;\n  conflicts: string[];\n  timestamp: number;\n}\n\ninterface AgentPerformance {\n  tasksCompleted: number;\n  averageTruthScore: number;\n  conflictRate: number;\n  responseTime: number;\n}\n\nexport class VerificationPipeline extends EventEmitter {\n  private config: PipelineConfig;\n  private tempDir: string;\n  private initialized: boolean = false;\n  private failureSimulations: Map<string, any> = new Map();\n  private delaySimulations: Map<string, number> = new Map();\n  private conflictSimulations: Map<string, any> = new Map();\n  private realisticSimulations: Map<string, any> = new Map();\n  private microservicesSimulations: Map<string, any> = new Map();\n  private agentFailureSimulations: Map<string, any> = new Map();\n  private verificationFailureConfig: any = null;\n  private agentPerformance: Map<string, AgentPerformance> = new Map();\n\n  constructor(config: PipelineConfig, tempDir: string) {\n    super();\n    this.config = config;\n    this.tempDir = tempDir;\n  }\n\n  async initialize(): Promise<void> {\n    // Create temp directories for verification data\n    await fs.mkdir(path.join(this.tempDir, 'verification'), { recursive: true });\n    await fs.mkdir(path.join(this.tempDir, 'results'), { recursive: true });\n\n    // Initialize agent performance tracking\n    for (const agent of this.config.agents) {\n      this.agentPerformance.set(agent.id, {\n        tasksCompleted: 0,\n        averageTruthScore: 0,\n        conflictRate: 0,\n        responseTime: 0\n      });\n    }\n\n    this.initialized = true;\n  }\n\n  async shutdown(): Promise<void> {\n    this.initialized = false;\n    this.removeAllListeners();\n  }\n\n  async updateConfig(config: PipelineConfig): Promise<void> {\n    this.config = config;\n\n    // Add new agents to performance tracking\n    for (const agent of config.agents) {\n      if (!this.agentPerformance.has(agent.id)) {\n        this.agentPerformance.set(agent.id, {\n          tasksCompleted: 0,\n          averageTruthScore: 0,\n          conflictRate: 0,\n          responseTime: 0\n        });\n      }\n    }\n  }\n\n  setFailureSimulation(taskId: string, failures: any): void {\n    this.failureSimulations.set(taskId, failures);\n  }\n\n  setDelaySimulation(taskId: string, delay: number): void {\n    this.delaySimulations.set(taskId, delay);\n  }\n\n  setConflictSimulation(taskId: string, conflicts: any): void {\n    this.conflictSimulations.set(taskId, conflicts);\n  }\n\n  setRealisticSimulation(taskId: string, simulation: any): void {\n    this.realisticSimulations.set(taskId, simulation);\n  }\n\n  setMicroservicesSimulation(taskId: string, simulation: any): void {\n    this.microservicesSimulations.set(taskId, simulation);\n  }\n\n  setAgentFailureSimulation(agentId: string, config: any): void {\n    this.agentFailureSimulations.set(agentId, config);\n  }\n\n  setVerificationFailureSimulation(config: any): void {\n    this.verificationFailureConfig = config;\n  }\n\n  async executeTask(taskId: string): Promise<PipelineResult> {\n    const task = this.config.tasks.find(t => t.id === taskId);\n    if (!task) {\n      throw new Error(`Task not found: ${taskId}`);\n    }\n\n    const startTime = Date.now();\n    const verificationResults: VerificationStepResult[] = [];\n    const errors: string[] = [];\n    let status: 'completed' | 'failed' | 'timeout' | 'rejected' = 'completed';\n    let overallTruthScore = 1.0;\n\n    // Check for delay simulation\n    if (this.delaySimulations.has(taskId)) {\n      const delay = this.delaySimulations.get(taskId)!;\n      const timeout = this.config.timeoutMs;\n\n      if (delay > timeout) {\n        // Simulate timeout\n        await this.sleep(timeout + 100);\n        errors.push('Task execution timed out');\n        return {\n          taskId,\n          status: 'timeout',\n          truthScore: 0,\n          verificationResults,\n          duration: Date.now() - startTime,\n          agentPerformance: this.agentPerformance,\n          errors\n        };\n      }\n\n      await this.sleep(delay);\n    }\n\n    // Check for failure simulation\n    const failureSimulation = this.failureSimulations.get(taskId);\n    if (failureSimulation) {\n      // Execute with simulated failures\n      const result = await this.executeWithFailures(task, failureSimulation, verificationResults, errors);\n      status = result.status;\n      overallTruthScore = result.truthScore;\n    } else if (this.realisticSimulations.has(taskId)) {\n      // Execute with realistic simulation\n      const simulation = this.realisticSimulations.get(taskId)!;\n      await this.executeRealisticSimulation(task, simulation, verificationResults);\n      overallTruthScore = 0.85;\n    } else if (this.microservicesSimulations.has(taskId)) {\n      // Execute with microservices simulation\n      const simulation = this.microservicesSimulations.get(taskId)!;\n      await this.executeMicroservicesSimulation(task, simulation, verificationResults);\n      overallTruthScore = 0.87;\n    } else if (this.conflictSimulations.has(taskId)) {\n      // Execute with conflict simulation\n      const conflicts = this.conflictSimulations.get(taskId)!;\n      await this.executeWithConflicts(task, conflicts, verificationResults);\n      overallTruthScore = 0.75;\n    } else {\n      // Normal execution\n      await this.executeNormalWorkflow(task, verificationResults);\n      overallTruthScore = 0.85;\n    }\n\n    // Check for agent failures\n    for (const [agentId, failureConfig] of this.agentFailureSimulations.entries()) {\n      const elapsedTime = Date.now() - startTime;\n      if (elapsedTime >= failureConfig.failAfter) {\n        errors.push(`Agent failure detected: ${agentId}`);\n        errors.push(`Backup agent deployed: ${failureConfig.backupAgent}`);\n      }\n    }\n\n    // Check for verification system failures\n    if (this.verificationFailureConfig) {\n      if (Math.random() < this.verificationFailureConfig.failureProbability) {\n        verificationResults.push({\n          step: 'system-recovery',\n          agentId: 'system',\n          passed: true,\n          truthScore: 1.0,\n          evidence: { recoveryTime: this.verificationFailureConfig.recoveryTime },\n          conflicts: [],\n          timestamp: Date.now()\n        });\n      }\n    }\n\n    // Apply verification rules\n    const ruleResult = this.applyVerificationRules(overallTruthScore, verificationResults);\n    if (ruleResult.action === 'reject') {\n      status = 'rejected';\n    }\n\n    verificationResults.push({\n      step: 'rule-evaluation',\n      agentId: 'system',\n      passed: status !== 'rejected',\n      truthScore: overallTruthScore,\n      evidence: ruleResult,\n      conflicts: [],\n      timestamp: Date.now()\n    });\n\n    const duration = Date.now() - startTime;\n\n    return {\n      taskId,\n      status,\n      truthScore: overallTruthScore,\n      verificationResults,\n      duration,\n      agentPerformance: this.agentPerformance,\n      errors\n    };\n  }\n\n  private async executeWithFailures(\n    task: TaskConfig,\n    failures: any,\n    verificationResults: VerificationStepResult[],\n    errors: string[]\n  ): Promise<{ status: 'rejected'; truthScore: number }> {\n    // Simulate failed implementation\n    if (failures.implementation) {\n      verificationResults.push({\n        step: 'implementation',\n        agentId: 'coder-alpha',\n        passed: false,\n        truthScore: 0.2,\n        evidence: failures.implementation,\n        conflicts: [],\n        timestamp: Date.now()\n      });\n      errors.push(failures.implementation.reason);\n    }\n\n    // Simulate failed tests\n    if (failures.tests) {\n      verificationResults.push({\n        step: 'testing',\n        agentId: 'tester-gamma',\n        passed: false,\n        truthScore: 0.1,\n        evidence: failures.tests,\n        conflicts: [],\n        timestamp: Date.now()\n      });\n      errors.push(failures.tests.reason);\n    }\n\n    // Simulate failed build\n    if (failures.build) {\n      verificationResults.push({\n        step: 'build-verification',\n        agentId: 'reviewer-beta',\n        passed: false,\n        truthScore: 0.15,\n        evidence: failures.build,\n        conflicts: [],\n        timestamp: Date.now()\n      });\n      errors.push(failures.build.reason);\n    }\n\n    return { status: 'rejected', truthScore: 0.15 };\n  }\n\n  private async executeNormalWorkflow(\n    task: TaskConfig,\n    verificationResults: VerificationStepResult[]\n  ): Promise<void> {\n    // Emit step events\n    this.emit('step:start', { name: 'implementation' });\n    await this.sleep(100);\n\n    this.emit('step:start', { name: 'testing' });\n    await this.sleep(100);\n\n    this.emit('step:start', { name: 'code-review' });\n    await this.sleep(100);\n\n    if (task.verificationCriteria.requiresBuild) {\n      this.emit('step:start', { name: 'build-verification' });\n      await this.sleep(100);\n    }\n\n    if (task.verificationCriteria.crossVerificationRequired) {\n      this.emit('step:start', { name: 'cross-verification' });\n      await this.sleep(100);\n    }\n\n    // Add verification results\n    verificationResults.push(\n      {\n        step: 'testing',\n        agentId: 'tester-gamma',\n        passed: true,\n        truthScore: 0.9,\n        evidence: { testsPass: true },\n        conflicts: [],\n        timestamp: Date.now()\n      },\n      {\n        step: 'code-review',\n        agentId: 'reviewer-beta',\n        passed: true,\n        truthScore: 0.85,\n        evidence: { approved: true },\n        conflicts: [],\n        timestamp: Date.now()\n      },\n      {\n        step: 'build-verification',\n        agentId: 'coordinator-delta',\n        passed: true,\n        truthScore: 0.9,\n        evidence: { buildSuccess: true },\n        conflicts: [],\n        timestamp: Date.now()\n      },\n      {\n        step: 'cross-verification',\n        agentId: 'reviewer-beta',\n        passed: true,\n        truthScore: 0.88,\n        evidence: { verified: true },\n        conflicts: [],\n        timestamp: Date.now()\n      }\n    );\n\n    // Emit verification complete events\n    for (const result of verificationResults) {\n      this.emit('verification:complete', { step: result.step, agentId: result.agentId });\n    }\n  }\n\n  private async executeRealisticSimulation(\n    task: TaskConfig,\n    simulation: any,\n    verificationResults: VerificationStepResult[]\n  ): Promise<void> {\n    // Simulate implementation\n    await this.sleep(simulation.implementation?.duration || 100);\n    verificationResults.push({\n      step: 'implementation',\n      agentId: 'coder-alpha',\n      passed: true,\n      truthScore: 0.85,\n      evidence: simulation.implementation,\n      conflicts: [],\n      timestamp: Date.now()\n    });\n\n    // Simulate testing\n    await this.sleep(simulation.testing?.duration || 100);\n    verificationResults.push({\n      step: 'testing',\n      agentId: 'tester-gamma',\n      passed: true,\n      truthScore: 0.9,\n      evidence: simulation.testing,\n      conflicts: [],\n      timestamp: Date.now()\n    });\n\n    // Simulate review\n    await this.sleep(simulation.review?.duration || 100);\n    verificationResults.push({\n      step: 'code-review',\n      agentId: 'reviewer-beta',\n      passed: true,\n      truthScore: 0.92,\n      evidence: simulation.review,\n      conflicts: [],\n      timestamp: Date.now()\n    });\n\n    // Simulate verification with performance evidence\n    verificationResults.push({\n      step: 'performance-verification',\n      agentId: 'coordinator-delta',\n      passed: true,\n      truthScore: 0.88,\n      evidence: simulation.verification,\n      conflicts: [],\n      timestamp: Date.now()\n    });\n  }\n\n  private async executeMicroservicesSimulation(\n    task: TaskConfig,\n    simulation: any,\n    verificationResults: VerificationStepResult[]\n  ): Promise<void> {\n    // Add various microservices verification steps\n    verificationResults.push(\n      {\n        step: 'service-integration-test',\n        agentId: 'tester-gamma',\n        passed: true,\n        truthScore: 0.9,\n        evidence: { servicesIntegrated: simulation.services_implemented },\n        conflicts: [],\n        timestamp: Date.now()\n      },\n      {\n        step: 'load-testing',\n        agentId: 'tester-gamma',\n        passed: true,\n        truthScore: 0.85,\n        evidence: { requests_per_second: 250 },\n        conflicts: [],\n        timestamp: Date.now()\n      },\n      {\n        step: 'security-scan',\n        agentId: 'reviewer-beta',\n        passed: true,\n        truthScore: 0.92,\n        evidence: { vulnerabilities_found: 2 },\n        conflicts: [],\n        timestamp: Date.now()\n      }\n    );\n  }\n\n  private async executeWithConflicts(\n    task: TaskConfig,\n    conflicts: any,\n    verificationResults: VerificationStepResult[]\n  ): Promise<void> {\n    // Execute steps with conflict detection\n    for (const [agentId, assessment] of Object.entries(conflicts)) {\n      const agentAssessment = assessment as any;\n      this.emit('agent:assigned', { agentId, taskStep: 'verification' });\n\n      const hasConflict = agentAssessment.claimSuccess !== agentAssessment.actualSuccess;\n\n      verificationResults.push({\n        step: 'implementation-verification',\n        agentId,\n        passed: agentAssessment.actualSuccess,\n        truthScore: agentAssessment.actualSuccess ? 0.85 : 0.4,\n        evidence: agentAssessment,\n        conflicts: hasConflict ? ['Conflicting assessment detected'] : [],\n        timestamp: Date.now()\n      });\n    }\n\n    // Add conflict resolution step\n    verificationResults.push({\n      step: 'conflict-resolution',\n      agentId: 'coordinator-delta',\n      passed: true,\n      truthScore: 0.75,\n      evidence: { resolved: true },\n      conflicts: [],\n      timestamp: Date.now()\n    });\n  }\n\n  private applyVerificationRules(\n    truthScore: number,\n    verificationResults: VerificationStepResult[]\n  ): any {\n    for (const rule of this.config.verificationRules) {\n      if (rule.name === 'truth-score-threshold' && truthScore < rule.threshold) {\n        return { rule: rule.name, action: rule.action, triggered: true };\n      }\n\n      const conflictCount = verificationResults.filter(r => r.conflicts.length > 0).length;\n      if (rule.name === 'cross-verification-conflict' && conflictCount >= rule.threshold) {\n        return { rule: rule.name, action: rule.action, triggered: true };\n      }\n    }\n\n    return { triggered: false };\n  }\n\n  private sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n}\n"],"names":["EventEmitter","fs","path","VerificationPipeline","config","tempDir","initialized","failureSimulations","Map","delaySimulations","conflictSimulations","realisticSimulations","microservicesSimulations","agentFailureSimulations","verificationFailureConfig","agentPerformance","initialize","mkdir","join","recursive","agent","agents","set","id","tasksCompleted","averageTruthScore","conflictRate","responseTime","shutdown","removeAllListeners","updateConfig","has","setFailureSimulation","taskId","failures","setDelaySimulation","delay","setConflictSimulation","conflicts","setRealisticSimulation","simulation","setMicroservicesSimulation","setAgentFailureSimulation","agentId","setVerificationFailureSimulation","executeTask","task","tasks","find","t","Error","startTime","Date","now","verificationResults","errors","status","overallTruthScore","get","timeout","timeoutMs","sleep","push","truthScore","duration","failureSimulation","result","executeWithFailures","executeRealisticSimulation","executeMicroservicesSimulation","executeWithConflicts","executeNormalWorkflow","failureConfig","entries","elapsedTime","failAfter","backupAgent","Math","random","failureProbability","step","passed","evidence","recoveryTime","timestamp","ruleResult","applyVerificationRules","action","implementation","reason","tests","build","emit","name","verificationCriteria","requiresBuild","crossVerificationRequired","testsPass","approved","buildSuccess","verified","testing","review","verification","servicesIntegrated","services_implemented","requests_per_second","vulnerabilities_found","assessment","Object","agentAssessment","taskStep","hasConflict","claimSuccess","actualSuccess","resolved","rule","verificationRules","threshold","triggered","conflictCount","filter","r","length","ms","Promise","resolve","setTimeout"],"mappings":"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"}